<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í¬ë¦½í†  ê°€ê²© ì˜ˆì¸¡ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-root: #050507;
            --bg-card: #0c0c10;
            --bg-card-hover: #111116;
            --border: #1a1a22;
            --border-light: #24242e;
            --text-primary: #eeeef0;
            --text-secondary: #7a7a8a;
            --text-muted: #4a4a58;
            --accent-green: #00e68a;
            --accent-blue: #4d8eff;
            --accent-orange: #ff8a4d;
            --accent-red: #ff5252;
            --radius: 14px;
            --radius-sm: 8px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { -webkit-text-size-adjust: 100%; overflow-x: hidden; max-width: 100vw; }

        body {
            background: var(--bg-root) !important;
            color: var(--text-primary);
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            min-height: 0;
        }

        .container {
            max-width: 1040px;
            margin: 0 auto;
            padding: 20px 16px 32px;
        }

        /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 8px;
        }

        .header-left h1 {
            font-size: 1.35rem;
            font-weight: 700;
            letter-spacing: -0.03em;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .header-left p {
            font-size: 0.78rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .update-badge {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: var(--text-muted);
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 5px 10px;
            border-radius: 20px;
            white-space: nowrap;
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* â”€â”€ Asset Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .asset-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 4px;
        }

        .asset-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 10px 8px;
            border-radius: 9px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .asset-tab:hover { color: var(--text-primary); background: rgba(255,255,255,0.03); }
        .asset-tab.active { background: var(--border-light); color: var(--text-primary); font-weight: 600; }

        .tab-price {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.72rem;
            font-weight: 500;
            opacity: 0.7;
        }

        .tab-symbol { font-weight: 700; letter-spacing: 0.02em; }

        /* â”€â”€ Range Overview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .range-overview {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scroll-snap-type: x mandatory;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .range-overview::-webkit-scrollbar { display: none; }

        .range-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 14px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            flex: 1 0 0;
            min-width: 0;
            scroll-snap-align: start;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .range-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 2px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .range-card:hover { border-color: var(--border-light); background: var(--bg-card-hover); }
        .range-card.active { border-color: var(--border-light); }
        .range-card.active::before { opacity: 1; }

        .range-card[data-tf="weekly"]::before { background: var(--accent-green); }
        .range-card[data-tf="monthly"]::before { background: var(--accent-blue); }
        .range-card[data-tf="yearly"]::before { background: var(--accent-orange); }

        .range-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .range-tf-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .range-card[data-tf="weekly"] .range-tf-label { color: var(--accent-green); }
        .range-card[data-tf="monthly"] .range-tf-label { color: var(--accent-blue); }
        .range-card[data-tf="yearly"] .range-tf-label { color: var(--accent-orange); }

        .range-period { font-size: 0.65rem; color: var(--text-muted); font-weight: 400; }

        .range-bar-container { position: relative; height: 28px; margin-bottom: 10px; }

        .range-bar-track {
            position: absolute; top: 50%; left: 0; right: 0;
            height: 3px; background: var(--border); border-radius: 2px;
            transform: translateY(-50%);
        }

        .range-bar-fill {
            position: absolute; top: 50%; height: 5px; border-radius: 3px;
            transform: translateY(-50%); opacity: 0.6;
        }

        .range-card[data-tf="weekly"] .range-bar-fill { background: var(--accent-green); }
        .range-card[data-tf="monthly"] .range-bar-fill { background: var(--accent-blue); }
        .range-card[data-tf="yearly"] .range-bar-fill { background: var(--accent-orange); }

        .range-bar-current {
            position: absolute; top: 50%;
            width: 9px; height: 9px;
            background: var(--text-primary); border-radius: 50%;
            transform: translate(-50%, -50%); z-index: 2;
            box-shadow: 0 0 0 3px var(--bg-card);
        }

        .range-values { display: flex; justify-content: space-between; align-items: baseline; }

        .range-val { font-family: 'JetBrains Mono', monospace; font-size: 0.78rem; font-weight: 500; }
        .range-val.low { color: var(--accent-red); }
        .range-val.high { color: var(--accent-green); }

        .range-val-label {
            font-size: 0.6rem; color: var(--text-muted); font-weight: 400;
            font-family: 'Outfit', sans-serif; margin-left: 3px;
        }

        .range-no-data { text-align: center; color: var(--text-muted); font-size: 0.78rem; padding: 16px 0; }

        /* â”€â”€ Chart Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .chart-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 18px;
            margin-bottom: 16px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .chart-title-group h3 { font-size: 0.95rem; font-weight: 600; color: var(--text-primary); margin-bottom: 2px; }
        .chart-title-group p { font-size: 0.72rem; color: var(--text-secondary); }

        .chart-controls { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
        .chart-legend { display: flex; gap: 12px; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.7rem; color: var(--text-secondary); }
        .legend-dot { width: 8px; height: 8px; border-radius: 2px; }
        .legend-dot.up { background: var(--accent-green); }
        .legend-dot.down { background: var(--accent-red); }

        /* Horizontal scroll wrapper for chart on mobile */
        .chart-scroll-wrap {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            margin: 0 -4px;
            padding: 0 4px;
        }
        .chart-scroll-wrap::-webkit-scrollbar { display: none; }

        .chart-canvas-wrap {
            height: 320px;
            position: relative;
            min-width: 100%;
        }

        /* â”€â”€ Timeframe Tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .tf-tabs { display: flex; gap: 3px; background: var(--bg-root); border-radius: 8px; padding: 3px; }

        .tf-tab {
            padding: 5px 12px; border-radius: 6px; border: none;
            background: transparent; color: var(--text-muted);
            font-family: 'Outfit', sans-serif; font-size: 0.72rem; font-weight: 500;
            cursor: pointer; transition: all 0.15s ease;
            -webkit-tap-highlight-color: transparent; touch-action: manipulation;
        }

        .tf-tab:hover { color: var(--text-secondary); }
        .tf-tab.active { background: var(--border-light); color: var(--text-primary); font-weight: 600; }

        /* â”€â”€ Probability Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .prob-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 18px;
            margin-bottom: 16px;
        }

        .prob-section h3 { font-size: 0.9rem; font-weight: 600; margin-bottom: 14px; }

        .prob-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

        .prob-col-title {
            font-size: 0.68rem; font-weight: 600; text-transform: uppercase;
            letter-spacing: 0.08em; margin-bottom: 8px;
            display: flex; align-items: center; gap: 5px;
        }
        .prob-col-title.up { color: var(--accent-green); }
        .prob-col-title.down { color: var(--accent-red); }

        .prob-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.03); gap: 8px;
        }
        .prob-row:last-child { border-bottom: none; }

        .prob-price {
            font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;
            font-weight: 500; color: var(--text-primary); white-space: nowrap; flex-shrink: 0;
        }

        .prob-bar-wrap { display: flex; align-items: center; gap: 6px; flex: 1; min-width: 0; }

        .prob-bar-bg { flex: 1; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; min-width: 30px; }
        .prob-bar-fill { height: 100%; border-radius: 2px; transition: width 0.4s ease; }
        .prob-bar-fill.up { background: var(--accent-green); }
        .prob-bar-fill.down { background: var(--accent-red); }

        .prob-pct {
            font-family: 'JetBrains Mono', monospace; font-size: 0.68rem;
            color: var(--text-secondary); min-width: 34px; text-align: right; flex-shrink: 0;
        }

        /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .footer {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.68rem; color: var(--text-muted); padding-top: 2px; gap: 8px; flex-wrap: wrap;
        }

        .footer-source { display: flex; align-items: center; gap: 6px; }

        .polymarket-tag {
            background: var(--border); color: var(--text-secondary);
            padding: 3px 8px; border-radius: 4px; font-weight: 500; font-size: 0.64rem;
        }

        /* â”€â”€ Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .loading-state {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; padding: 60px 0; color: var(--text-muted); gap: 10px;
        }

        .spinner {
            width: 24px; height: 24px;
            border: 2px solid var(--border); border-top-color: var(--text-secondary);
            border-radius: 50%; animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MOBILE BREAKPOINTS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        @media (max-width: 768px) {
            .container { padding: 16px 12px 28px; }
            .header-left h1 { font-size: 1.2rem; }
            .chart-canvas-wrap { height: 280px; }
        }

        @media (max-width: 520px) {
            .container { padding: 12px 10px 24px; }

            .header { margin-bottom: 14px; }
            .header-left h1 { font-size: 1.1rem; }
            .header-left p { font-size: 0.72rem; }
            .update-badge { font-size: 0.6rem; padding: 4px 8px; }

            .asset-tabs { margin-bottom: 12px; padding: 3px; gap: 2px; }
            .asset-tab { padding: 9px 4px; font-size: 0.82rem; gap: 5px; }
            .tab-price { font-size: 0.65rem; }

            /* Range cards: horizontal scroll, each ~72% width */
            .range-overview { gap: 6px; margin-bottom: 12px; }
            .range-card { flex: 0 0 72%; min-width: 0; padding: 12px 14px; }

            .chart-section { padding: 14px 12px; margin-bottom: 12px; }
            .chart-header { gap: 8px; margin-bottom: 12px; }
            .chart-title-group h3 { font-size: 0.88rem; }
            .chart-title-group p { font-size: 0.68rem; }
            .chart-controls { gap: 8px; }
            .chart-legend { gap: 8px; }
            .legend-item { font-size: 0.65rem; }
            .legend-dot { width: 7px; height: 7px; }
            .tf-tab { padding: 5px 10px; font-size: 0.68rem; }
            .chart-canvas-wrap { height: 260px; }

            .prob-section { padding: 14px 12px; margin-bottom: 12px; }
            .prob-section h3 { font-size: 0.85rem; margin-bottom: 10px; }
            .prob-grid { grid-template-columns: 1fr; gap: 18px; }
            .prob-col-title { font-size: 0.65rem; }
            .prob-price { font-size: 0.72rem; }
            .prob-pct { font-size: 0.65rem; min-width: 30px; }
            .footer { font-size: 0.62rem; }
        }

        @media (max-width: 380px) {
            .container { padding: 10px 8px 20px; }
            .header-left h1 { font-size: 1rem; }
            .tab-price { display: none; }
            .asset-tab { font-size: 0.8rem; padding: 8px 4px; }
            .range-card { flex: 0 0 78%; }
            .chart-canvas-wrap { height: 240px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>ğŸ”® í¬ë¦½í†  ê°€ê²© ì˜ˆì¸¡</h1>
                <p>Polymarket ì˜ˆì¸¡ ì‹œì¥ ê¸°ë°˜ Â· ì£¼ê°„ / ì›”ê°„ / ì—°ê°„</p>
            </div>
            <div class="update-badge" id="updateBadge">--</div>
        </div>

        <!-- Asset Tabs -->
        <div class="asset-tabs" id="assetTabs">
            <button class="asset-tab active" data-asset="btc">
                <span class="tab-symbol">BTC</span>
                <span class="tab-price" id="tab-price-btc">--</span>
            </button>
            <button class="asset-tab" data-asset="eth">
                <span class="tab-symbol">ETH</span>
                <span class="tab-price" id="tab-price-eth">--</span>
            </button>
            <button class="asset-tab" data-asset="sol">
                <span class="tab-symbol">SOL</span>
                <span class="tab-price" id="tab-price-sol">--</span>
            </button>
        </div>

        <!-- Range Overview Cards -->
        <div class="range-overview" id="rangeOverview">
            <div class="range-card active" data-tf="weekly" onclick="selectTimeframe('weekly')">
                <div class="range-card-header">
                    <span class="range-tf-label">ì´ë²ˆ ì£¼</span>
                    <span class="range-period" id="range-period-weekly">--</span>
                </div>
                <div class="range-bar-container" id="range-bar-weekly"></div>
                <div class="range-values">
                    <span class="range-val low" id="range-low-weekly">--</span>
                    <span class="range-val high" id="range-high-weekly">--</span>
                </div>
            </div>
            <div class="range-card" data-tf="monthly" onclick="selectTimeframe('monthly')">
                <div class="range-card-header">
                    <span class="range-tf-label">ì´ë²ˆ ë‹¬</span>
                    <span class="range-period" id="range-period-monthly">--</span>
                </div>
                <div class="range-bar-container" id="range-bar-monthly"></div>
                <div class="range-values">
                    <span class="range-val low" id="range-low-monthly">--</span>
                    <span class="range-val high" id="range-high-monthly">--</span>
                </div>
            </div>
            <div class="range-card" data-tf="yearly" onclick="selectTimeframe('yearly')">
                <div class="range-card-header">
                    <span class="range-tf-label">ì—°ê°„</span>
                    <span class="range-period" id="range-period-yearly">--</span>
                </div>
                <div class="range-bar-container" id="range-bar-yearly"></div>
                <div class="range-values">
                    <span class="range-val low" id="range-low-yearly">--</span>
                    <span class="range-val high" id="range-high-yearly">--</span>
                </div>
            </div>
        </div>

        <!-- Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <div class="chart-title-group">
                    <h3 id="chartTitle">ë„ë‹¬ í™•ë¥  ë¶„í¬</h3>
                    <p id="chartSubtitle">ê° ê°€ê²© ëª©í‘œì— ë„ë‹¬í•  í™•ë¥ </p>
                </div>
                <div class="chart-controls">
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-dot up"></span>ìƒìŠ¹ â†‘</span>
                        <span class="legend-item"><span class="legend-dot down"></span>í•˜ë½ â†“</span>
                    </div>
                    <div class="tf-tabs" id="tfTabs">
                        <button class="tf-tab active" data-tf="weekly" onclick="selectTimeframe('weekly')">ì£¼ê°„</button>
                        <button class="tf-tab" data-tf="monthly" onclick="selectTimeframe('monthly')">ì›”ê°„</button>
                        <button class="tf-tab" data-tf="yearly" onclick="selectTimeframe('yearly')">ì—°ê°„</button>
                    </div>
                </div>
            </div>
            <div class="chart-scroll-wrap" id="chartScrollWrap">
                <div class="chart-canvas-wrap" id="chartWrap">
                    <div class="loading-state">
                        <div class="spinner"></div>
                        <span>ë°ì´í„° ë¡œë”© ì¤‘...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Probability Table -->
        <div class="prob-section" id="probSection">
            <h3 id="probTitle">ìƒì„¸ í™•ë¥  ë°ì´í„°</h3>
            <div class="prob-grid" id="probGrid"></div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-source">
                <span class="polymarket-tag">Polymarket</span>
                <span>ì˜ˆì¸¡ ì‹œì¥ ë°ì´í„° ê¸°ë°˜ Â· íˆ¬ì ì¡°ì–¸ ì•„ë‹˜</span>
            </div>
        </div>
    </div>

    <script>
        let DATA = null;
        let activeAsset = 'btc';
        let activeTimeframe = 'weekly';
        let chart = null;

        Chart.defaults.color = '#4a4a58';
        Chart.defaults.borderColor = '#1a1a22';
        Chart.defaults.font.family = "'Outfit', sans-serif";

        async function loadData() {
            try {
                const resp = await fetch('data.json');
                if (!resp.ok) throw new Error('Data not found');
                DATA = await resp.json();
                initDashboard();
            } catch (e) {
                console.error(e);
                document.getElementById('chartWrap').innerHTML =
                    '<div class="loading-state"><span>âš ï¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span></div>';
            }
        }

        function initDashboard() {
            for (const [key, asset] of Object.entries(DATA.assets)) {
                const el = document.getElementById(`tab-price-${key}`);
                if (el) el.textContent = formatPrice(asset.current_price, key);
            }
            if (DATA.last_updated) {
                const d = new Date(DATA.last_updated);
                const kst = new Date(d.getTime() + 9 * 60 * 60 * 1000);
                document.getElementById('updateBadge').textContent =
                    kst.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }) + ' KST';
            }
            document.querySelectorAll('.asset-tab').forEach(tab => {
                tab.addEventListener('click', () => selectAsset(tab.dataset.asset));
            });
            renderAll();
        }

        function selectAsset(asset) {
            activeAsset = asset;
            document.querySelectorAll('.asset-tab').forEach(t => t.classList.toggle('active', t.dataset.asset === asset));
            renderAll();
        }

        function selectTimeframe(tf) {
            activeTimeframe = tf;
            document.querySelectorAll('.range-card').forEach(c => c.classList.toggle('active', c.dataset.tf === tf));
            document.querySelectorAll('.tf-tab').forEach(t => t.classList.toggle('active', t.dataset.tf === tf));
            renderChart();
            renderProbTable();
        }

        function renderAll() { renderRangeCards(); renderChart(); renderProbTable(); }

        function formatPrice(val, assetKey) {
            if (val == null) return '--';
            if (assetKey === 'sol' || (assetKey !== 'btc' && val < 1000))
                return '$' + val.toLocaleString('en-US', { maximumFractionDigits: val < 10 ? 2 : 0 });
            return '$' + val.toLocaleString('en-US', { maximumFractionDigits: 0 });
        }

        function formatPriceShort(val, assetKey) {
            if (val == null) return '--';
            if (assetKey === 'sol') return '$' + Math.round(val);
            if (assetKey === 'eth')
                return val >= 10000 ? '$' + (val / 1000).toFixed(1) + 'K' : '$' + val.toLocaleString('en-US', { maximumFractionDigits: 0 });
            if (val >= 1000) return '$' + (val / 1000).toFixed(val >= 100000 ? 0 : 1) + 'K';
            return '$' + val;
        }

        function getPeriodLabel(tf, assetData) {
            const tfData = assetData?.timeframes?.[tf];
            if (!tfData) return '--';
            if (tf === 'weekly') {
                const title = tfData.event_title || '';
                const match = title.match(/((?:January|February|March|April|May|June|July|August|September|October|November|December)\s+\d[\d\s\-â€“,]*\d)/i);
                return match ? match[1] : tfData.period || '--';
            }
            return tfData.period || '--';
        }

        // â”€â”€ Range Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderRangeCards() {
            const asset = DATA.assets[activeAsset];
            if (!asset) return;

            ['weekly', 'monthly', 'yearly'].forEach(tf => {
                const tfData = asset.timeframes?.[tf];
                const periodEl = document.getElementById(`range-period-${tf}`);
                const lowEl = document.getElementById(`range-low-${tf}`);
                const highEl = document.getElementById(`range-high-${tf}`);
                const barEl = document.getElementById(`range-bar-${tf}`);

                if (!tfData) {
                    periodEl.textContent = '--';
                    lowEl.textContent = '--';
                    highEl.textContent = '--';
                    barEl.innerHTML = '<div class="range-no-data">ë°ì´í„° ì—†ìŒ</div>';
                    return;
                }

                periodEl.textContent = getPeriodLabel(tf, asset);
                lowEl.innerHTML = formatPrice(tfData.expected_low, activeAsset) + '<span class="range-val-label">ì˜ˆìƒ ì €ì </span>';
                highEl.innerHTML = formatPrice(tfData.expected_high, activeAsset) + '<span class="range-val-label">ì˜ˆìƒ ê³ ì </span>';
                renderRangeBar(barEl, tfData, asset.current_price);
            });
        }

        function renderRangeBar(container, tfData, currentPrice) {
            if (!tfData.expected_low || !tfData.expected_high) { container.innerHTML = ''; return; }
            const low = tfData.expected_low, high = tfData.expected_high;
            const rangeMin = low * 0.92, rangeMax = high * 1.08, total = rangeMax - rangeMin;
            const fillLeft = ((low - rangeMin) / total * 100).toFixed(1);
            const fillRight = ((rangeMax - high) / total * 100).toFixed(1);
            const fillWidth = (100 - parseFloat(fillLeft) - parseFloat(fillRight)).toFixed(1);
            const currentPos = Math.min(100, Math.max(0, ((currentPrice - rangeMin) / total * 100))).toFixed(1);

            container.innerHTML = `
                <div class="range-bar-track"></div>
                <div class="range-bar-fill" style="left:${fillLeft}%; width:${fillWidth}%"></div>
                <div class="range-bar-current" style="left:${currentPos}%" title="í˜„ì¬ê°€ ${formatPrice(currentPrice, activeAsset)}"></div>
            `;
        }

        // â”€â”€ Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderChart() {
            const asset = DATA.assets[activeAsset];
            const tfData = asset?.timeframes?.[activeTimeframe];
            const wrap = document.getElementById('chartWrap');
            const scrollWrap = document.getElementById('chartScrollWrap');

            if (!tfData || (!tfData.upside.length && !tfData.downside.length)) {
                wrap.style.minWidth = '100%';
                wrap.innerHTML = '<div class="loading-state"><span>ì´ ê¸°ê°„ì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</span></div>';
                return;
            }

            // Dynamic width: ensure bars aren't too thin on mobile
            const totalBars = tfData.downside.length + tfData.upside.length;
            const isMobile = window.innerWidth <= 520;
            const minBarWidth = isMobile ? 34 : 40;
            const containerWidth = scrollWrap.clientWidth;
            const dynamicMinWidth = Math.max(totalBars * minBarWidth, containerWidth);
            wrap.style.minWidth = dynamicMinWidth + 'px';

            wrap.innerHTML = '<canvas id="mainChart"></canvas>';
            const ctx = document.getElementById('mainChart').getContext('2d');

            // Downside (left, sorted lowâ†’high) then Upside (right, sorted lowâ†’high)
            const downSorted = [...tfData.downside].sort((a, b) => a.price - b.price);
            const upSorted = [...tfData.upside].sort((a, b) => a.price - b.price);
            const allData = [
                ...downSorted.map(d => ({ ...d, dir: 'down' })),
                ...upSorted.map(d => ({ ...d, dir: 'up' }))
            ];

            const labels = allData.map(d => formatPriceShort(d.price, activeAsset));
            const probs = allData.map(d => d.probability);
            const colors = allData.map(d => d.dir === 'up' ? '#00e68a' : '#ff5252');
            const bgColors = allData.map(d => d.dir === 'up' ? 'rgba(0,230,138,0.7)' : 'rgba(255,82,82,0.7)');
            const linePos = downSorted.length - 0.5;

            if (chart) chart.destroy();

            const tickSize = isMobile ? 9 : 10;

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        data: probs,
                        backgroundColor: bgColors,
                        borderColor: colors,
                        borderWidth: 1,
                        borderRadius: isMobile ? 3 : 4,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    animation: { duration: 350, easing: 'easeOutQuart' },
                    layout: {
                        padding: { top: 10, bottom: 0, left: 0, right: 0 }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#0c0c10',
                            titleColor: '#eeeef0',
                            bodyColor: '#eeeef0',
                            borderColor: '#24242e',
                            borderWidth: 1,
                            padding: 12,
                            cornerRadius: 8,
                            displayColors: false,
                            titleFont: { family: "'JetBrains Mono', monospace", size: 11, weight: 600 },
                            bodyFont: { family: "'Outfit', sans-serif", size: 11 },
                            callbacks: {
                                title: (items) => {
                                    const d = allData[items[0].dataIndex];
                                    const dir = d.dir === 'up' ? 'â†‘ ìƒìŠ¹' : 'â†“ í•˜ë½';
                                    return `${asset.symbol} ${formatPrice(d.price, activeAsset)} ${dir}`;
                                },
                                label: (item) => `ë„ë‹¬ í™•ë¥ : ${item.raw.toFixed(1)}%`
                            }
                        },
                        annotation: {
                            annotations: {
                                currentLine: {
                                    type: 'line',
                                    xMin: linePos,
                                    xMax: linePos,
                                    borderColor: 'rgba(238,238,240,0.5)',
                                    borderWidth: 1.5,
                                    borderDash: [5, 4],
                                    label: {
                                        display: true,
                                        content: 'í˜„ì¬ê°€ ' + formatPrice(asset.current_price, activeAsset),
                                        position: 'start',
                                        backgroundColor: 'rgba(238,238,240,0.9)',
                                        color: '#050507',
                                        font: { size: isMobile ? 9 : 10, weight: 600, family: "'Outfit', sans-serif" },
                                        padding: { x: 6, y: 3 },
                                        borderRadius: 4
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: {
                                font: { family: "'JetBrains Mono', monospace", size: tickSize },
                                color: '#7a7a8a',
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            min: 0,
                            max: 100,
                            grid: { color: 'rgba(26,26,34,0.8)', drawBorder: false },
                            ticks: {
                                font: { family: "'JetBrains Mono', monospace", size: tickSize },
                                color: '#4a4a58',
                                callback: v => v + '%',
                                stepSize: 25
                            }
                        }
                    }
                }
            });

            // Titles
            const tfLabels = { weekly: 'ì£¼ê°„', monthly: 'ì›”ê°„', yearly: 'ì—°ê°„' };
            document.getElementById('chartTitle').textContent = `${asset.symbol} ${tfLabels[activeTimeframe]} ë„ë‹¬ í™•ë¥ `;
            document.getElementById('chartSubtitle').textContent = tfData.event_title || 'ê° ê°€ê²© ëª©í‘œì— ë„ë‹¬í•  í™•ë¥ ';

            // Auto-scroll to current price line on mobile when chart is wide
            if (isMobile && dynamicMinWidth > containerWidth) {
                const scrollTarget = (linePos / totalBars) * dynamicMinWidth - containerWidth / 2;
                setTimeout(() => {
                    scrollWrap.scrollTo({ left: Math.max(0, scrollTarget), behavior: 'smooth' });
                }, 120);
            }
        }

        // â”€â”€ Probability Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderProbTable() {
            const asset = DATA.assets[activeAsset];
            const tfData = asset?.timeframes?.[activeTimeframe];
            const grid = document.getElementById('probGrid');

            if (!tfData) {
                grid.innerHTML = '<div class="range-no-data" style="grid-column:1/-1">ë°ì´í„° ì—†ìŒ</div>';
                return;
            }

            const tfLabels = { weekly: 'ì£¼ê°„', monthly: 'ì›”ê°„', yearly: 'ì—°ê°„' };
            document.getElementById('probTitle').textContent = `${asset.symbol} ${tfLabels[activeTimeframe]} ìƒì„¸ í™•ë¥ `;

            let html = '';

            html += '<div>';
            html += '<div class="prob-col-title up">â†‘ ìƒìŠ¹ ëª©í‘œ</div>';
            if (tfData.upside.length === 0) {
                html += '<div style="color:var(--text-muted);font-size:0.78rem;">ë°ì´í„° ì—†ìŒ</div>';
            } else {
                tfData.upside.forEach(d => {
                    html += `<div class="prob-row">
                        <span class="prob-price">${formatPrice(d.price, activeAsset)}</span>
                        <div class="prob-bar-wrap">
                            <div class="prob-bar-bg"><div class="prob-bar-fill up" style="width:${d.probability}%"></div></div>
                            <span class="prob-pct">${d.probability.toFixed(1)}%</span>
                        </div>
                    </div>`;
                });
            }
            html += '</div>';

            html += '<div>';
            html += '<div class="prob-col-title down">â†“ í•˜ë½ ëª©í‘œ</div>';
            if (tfData.downside.length === 0) {
                html += '<div style="color:var(--text-muted);font-size:0.78rem;">ë°ì´í„° ì—†ìŒ</div>';
            } else {
                [...tfData.downside].reverse().forEach(d => {
                    html += `<div class="prob-row">
                        <span class="prob-price">${formatPrice(d.price, activeAsset)}</span>
                        <div class="prob-bar-wrap">
                            <div class="prob-bar-bg"><div class="prob-bar-fill down" style="width:${d.probability}%"></div></div>
                            <span class="prob-pct">${d.probability.toFixed(1)}%</span>
                        </div>
                    </div>`;
                });
            }
            html += '</div>';

            grid.innerHTML = html;
        }

        // Reflow chart on resize
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => { if (DATA) renderChart(); }, 250);
        });

        loadData();
    </script>
</body>
</html>
